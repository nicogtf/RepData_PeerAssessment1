---
title: 'Reproducible Research: Peer Assessment 1'
author: "Nicola Barbieri"
date: "`r Sys.Date()`"
output: html_document
---

## Loading and preprocessing the data
Data was obtained forking the repository [https://github.com/rdpeng/RepData_PeerAssessment1](https://github.com/rdpeng/RepData_PeerAssessment1).

```{r}
df <- read.csv('./data/activity.csv')
```

Head and tail

```{r}
head(df)
tail(df)
```

Table dimensions

```{r}
dim(df)
```

Structure of data

```{r}
str(df)
```



Convert the variable 'date' to Date type:

```{r}
df$date <- as.Date(as.character(df$date), format = '%Y-%m-%d')
```
Summary

```{r}
summary(df)
```

We can see that there 2304 missing values in the column 'steps.
The percentage of missing values is:

```{r}
mean(is.na(df$steps))
```

## What is mean total number of steps taken per day?

Total number of steps counted:

```{r}
sum(df$steps, na.rm = T)
```
Histogram of steps per day:

```{r}
library(ggplot2)
p1 <- ggplot(df, aes(x=steps)) 
p1 <- p1 + geom_histogram(bins = 100, na.rm = T)
p1
```

Mean and Median of steps:

```{r}
mean(df$steps, na.rm = T)
median(df$steps, na.rm = T)
```


## What is the average daily activity pattern?

```{r}
library(dplyr)
steps_interval <- df %>% group_by(interval) %>% summarise('steps_mean' = mean(steps, na.rm = T), 'steps_median' = median(steps, na.rm = T))
summary(steps_interval)
```
Plot: time series

```{r}
p2 <- ggplot(steps_interval, aes(x=interval, y=steps_mean))
p2 <- p2 + geom_line()
p2
```

Interval with maximum average of steps:

```{r}
which.max(steps_interval$steps_mean)
```

## Imputing missing values

###Replacing NA's with mean of interval:

```{r}
df1 <- left_join(df, steps_interval, by= "interval")
df1$steps_no_na <- ifelse(is.na(df1$steps), df1$steps_mean, df1$steps)

summary(df1)
```

Histogram of steps per day, after replacing NA's:

```{r}
library(ggplot2)
p1 <- ggplot(df1, aes(x=steps_no_na)) 
p1 <- p1 + geom_histogram(bins = 100, na.rm = T)
p1
```


Mean and Median of steps:

```{r}
mean(df1$steps_no_na, na.rm = T)
median(df1$steps_no_na, na.rm = T)
```

There is no difference in mean and median (although the 3rd quantile is now 27, instead of 12)

###Replacing NA's with median of interval:

```{r}
df2 <- left_join(df, steps_interval, by= "interval")
df2$steps_no_na <- ifelse(is.na(df2$steps), df2$steps_median, df2$steps)
#names(df2) <- c('steps', 'date', 'interval', 'steps_avg_interval', 'steps_no_na')
summary(df2)
```

Histogram of steps per day, after replacing NA's:

```{r}
library(ggplot2)
p2 <- ggplot(df2, aes(x=steps_no_na)) 
p2 <- p2 + geom_histogram(bins = 100, na.rm = T)
p2
```


Mean and Median of steps:

```{r}
mean(df2$steps_no_na, na.rm = T)
median(df2$steps_no_na, na.rm = T)
```

###Replacing NA's with total of daily steps:

```{r}
steps_day <- df %>% group_by(date) %>% summarise('steps_mean' = mean(steps, na.rm = T), 'steps_total' = sum(steps, na.rm = T))
df3 <- left_join(df, steps_day, by= "date")
df3$steps_no_na <- ifelse(is.na(df3$steps), df3$steps_total, df3$steps)
#names(df2) <- c('steps', 'date', 'interval', 'steps_avg_interval', 'steps_no_na')
summary(df3)
```

Histogram of steps per day, after replacing NA's:

```{r}
library(ggplot2)
p3 <- ggplot(df3, aes(x=steps_no_na)) 
p3 <- p3 + geom_histogram(bins = 100, na.rm = T)
p3
```


Mean and Median of steps:

```{r}
mean(df3$steps_no_na, na.rm = T)
median(df3$steps_no_na, na.rm = T)
```


## Are there differences in activity patterns between weekdays and weekends?

```{r}
library(lubridate)
df4 <- df1[,c(2,3,6)]
df4$wday <- wday(df4$date, week_start = 1)
df4$weekday <- weekdays(df4$date)
df4$day_type <- as.factor(ifelse((df4$wday<6), 'weekday', 'weekend'))
```

Group df4 by interval and compute the mean:

```{r}
df4 <- df4 %>% group_by(day_type, interval) %>% summarise('steps_no_na_avg' = mean(steps_no_na))
```



Panel plot:

```{r}
p4 <- ggplot(df4, aes(interval, steps_no_na_avg, color = day_type, group = day_type))
p4 <- p4 + geom_line()
p4 <- p4 + ylab('Number of Steps')
p4 <- p4 + facet_wrap(vars(day_type), nrow = 2)
p4
```

